/*!
 * jQuery infiniteScroller - v0.1pre - 9/24/2010
 * http://benalman.com/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(e){var d="infiniteScroller",c;e.fn[d]=c=function(a){a=e.extend({},c.options,a);var b={Width:"Height",Left:"Top"};e.each(b,function(g,h){if(axis==="x"){b[g]=h=g}b[g.toLowerCase()]=h.toLowerCase()});return this.each(function(){var T=e(this),ar=T[0]===document.body?e(window):T,ag=T.children(".scroller-content"),ae,aq,Y=ag.children(".scroller-loading:first-child"),V=ag.children(".scroller-loading:last-child"),W=ah(Y)||0,Q=ah(V)||0,R=0,M=0,U,aa,S,L;ai(false,true);al(ae.eq(0));function O(){var f=L;L=ap();if(a.pagechange&&f!==L){a.pagechange.call(ae.eq(L),ae.eq(f))}if(a.scroll){a.scroll.call(T,ad(T)-R)}if(a.search_type=="loc_sort_order"){am(-1)}am(1)}O();Z();ao();ar.bind("scroll."+d+" resize."+d,O);T.bind("reflow."+d,Z);T.bind("set-zero."+d,ao);T.bind("move-to."+d,function(g,f){X(f)});T.bind("move-by."+d,function(h,g){var f={dir:1,amount:ab("scroll_by")};g=e.extend(f,typeof g==="number"?{amount:g}:g);if(g.amount==="page"){N(g.dir)}else{an(g.dir*g.amount)}});function Z(){ai(true);ac(L,true)}function ai(f,g){ae=ag.children(".scroller-page");aq=[];U=aa=ad(ae.eq(0));ae.each(function(j){var i=e(this);f&&af(i,aa);aq[j]={start:aa,end:aa+ah(i,true)};aa+=ah(i)});W&&af(Y,U-W);Q&&af(V,aa);var h=P();if(h<0){af(ag,W&&Q?(ah(T)-aa)/2:W?ah(T)-aa:Q?U:-h/2)}else{af(ag,W-U);if(g){}}}function al(f){f.addClass("scroller-page").data(d,{})}function N(g,h){var f=L+g;f=Math.min(Math.max(f,0),ae.length);ac(f,h)}function ac(f,g){X(ae.eq(f),g)}function an(g,f,h){X(g,f,h,true)}function X(i,l,t,h){var o=a.scroll_duration,g=ad(T),q,k,s,p,m,r,n;if(i&&typeof i!=="number"){if((q=e(i)).length){m=W-U-R-ab("offset")[0],r=ak(),n=r.start-r.end;k=aq[ae.index(q)];s=k.start;p=k.end;i=(s-p<n?s:(s+p+n)/2)+m}else{return}}S=f(h?g+i:i+R);if(!t){T.stop(true,false);M=0}if(!o||l){j(S)}else{T.scrollTop(g).animate({scrollTop:S},{step:function(v,u){j(v-M)},duration:o})}function f(u){var v=P();return Math.min(Math.max(u,Math.min(0,v)),Math.max(0,v))}function j(u){ar["scroll"+b.Left](f(u))}}function am(k){var l=k!==1,g=ae.eq(l?0:ae.length-1),j=g.data(d),n=a.fetch,m=l?"prev":"next",h=l?W:Q,f=ad(T),i=(l?f:P()-f)-h;if(h&&!j[m]&&e.isFunction(n)&&i<=ab("threshold")){j[m]=true;setTimeout(function(){n.call(g,k,function(p){if(p===false){if(l){M+=W;ao(R-W);an(-W,true,true);Y.hide();W=0}else{V.hide();Q=0}ai()}else{if(p){var o;p=e(p);al(p);if(l){Y.after(p);o=ah(p);af(p,ad(g)-o);ai();ao(R+o);an(o,true,true);M-=o}else{V.before(p);af(p,ad(g)+ah(g));ai()}am(k)}else{delete j[m]}}})},1)}}function ad(f){return f[0]===T[0]?ar["scroll"+b.Left]():f.position()[b.left]}function af(h,g){var f={};if(g!==ad(h)){f[b.left]=g;h.css(f)}}function ah(f,g){return f[0]===ag[0]?W+Q+aa-U:f[(f[0]===T[0]?"inner":"outer")+b.Width](!g)}function aj(g,f){g[b.width](f)}function ab(g){var f=a[g];return e.isFunction(f)?f.call(T,ah(T)):f}function P(){return ah(ag)-ah(T)}function ao(f){R=typeof f==="number"?f:ad(T)}function ak(){var g=ad(T)+U-W,f=ab("offset");return{start:g+f[0],end:g+ah(T)-f[1]}}function ap(){var h=ak(),i=h.start,m=h.end,g,k=[],l=[],f=[],j;e.each(aq,function(p,o){var n=o.start,q=o.end;if(n>=m){return false}if(n>=i){if(q<=m){g=k.push(p)}else{l.push(p)}}else{if(q>i){l.push(p)}}});f=e.map(g?k:l,function(p){var o=aq[p],n=o.start,q=o.end;return{i:p,d:g?Math.abs((i+m-n-q)/2):n<i?i-q:n-m}}).sort(function(n,o){return n.d-o.d});return f.length?f[0].i:0}})};c.options={axis:"x",threshold:function(a){return a},scroll_by:function(a){return a},position:function(a,b){return(a+b)/2},pagechange:function(a){},scroll:function(a){},scroll_duration:400,offset:[0,0],fetch:null}})(jQuery);
/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 *
 * Requires: 1.2.2+
 */
(function(f){function b(h){var d=h||window.event,l=[].slice.call(arguments,1),j=0,k=0,i=0,h=f.event.fix(d);h.type="mousewheel";d.wheelDelta&&(j=d.wheelDelta/120);d.detail&&(j=-d.detail/3);i=j;d.axis!==void 0&&d.axis===d.HORIZONTAL_AXIS&&(i=0,k=-1*j);d.wheelDeltaY!==void 0&&(i=d.wheelDeltaY/120);d.wheelDeltaX!==void 0&&(k=-1*d.wheelDeltaX/120);l.unshift(h,j,k,i);return(f.event.dispatch||f.event.handle).apply(this,l)}var g=["DOMMouseScroll","mousewheel"];if(f.event.fixHooks){for(var a=g.length;a;){f.event.fixHooks[g[--a]]=f.event.mouseHooks}}f.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var c=g.length;c;){this.addEventListener(g[--c],b,false)}}else{this.onmousewheel=b}},teardown:function(){if(this.removeEventListener){for(var c=g.length;c;){this.removeEventListener(g[--c],b,false)}}else{this.onmousewheel=null}}};f.fn.extend({mousewheel:function(c){return c?this.bind("mousewheel",c):this.trigger("mousewheel")},unmousewheel:function(c){return this.unbind("mousewheel",c)}})})(jQuery);
/*!
	Stack View - The jQuery virutal stack plugin
	by The Harvard Library Innovation Lab
	
	Dual licensed under MIT and GPL.
*/
(function(f,e,a,g){var d="stackview",b,c=+new Date();b=function(i,h){this.element=i;this.$element=f(i);this.$wrapper=f('<div id="'+f.element.id+'-wrapper" />');this.init()};f.extend(true,b.prototype,{defaults:{url:"basic.json",data:"",jsonp:false,books_per_page:10,threshold:1000,page_multiple:0.11,height_multiple:12,search_type:"keyword",query:"",ribbon:"Stack View"},init:function(j){var i=this,k=this.$element.data("scroller");this.options=f.extend({},this.defaults,j);this.$element.addClass("scroller").html('<div class="scroller-content"><div class="scroller-loading scroller-loading-prev" /><div class="scroller-page" /><div class="scroller-loading scroller-loading-next" /></div>').wrap(this.$wrapper).bind("mousewheel",function(l,m){f(this).trigger("move-by",-m*75);return false});this.$wrapper.prepend('<div class="navigation"><div class="upstream" /><div class="num-found" /><div class="downstream" /></div><div class="ribbon"><div class="ribbonBody" /><div class="ribbonBehind" /></div>').delegate(".upstream","click",function(){i.$element.trigger("move-by",-475);return false}).delegate(".downstream","click",function(){i.$element.trigger("move-by",475);return false}).find(".ribbonBody").text(this.options.ribbon);if(j===false){this.$element.unbind(".infiniteScroller");this.$element.replaceWith(k.clone);return}if(!k){this.$element.data("scroller",k={clone:this.$element.clone(),options:j})}function h(n,x,u,p,w,q){var s=i.options.search_type==="loc_sort_order",m=i.options.books_per_page*0.5;if(s&&u==="downstream"){i.options.query="["+x+"%20TO%20"+(x+m)+"]"}if(s&&u==="upstream"){i.options.query="["+(x-m)+"%20TO%20"+x+"]"}if(s&&u==="center"){i.options.query="["+(x-6)+"%20TO%20"+(x+m-6)+"]"}var o=f.param({id:i.options.id,limit:i.options.books_per_page*(u!=="center"?1:0.5),mode:u,query:i.options.query,start:p,search_type:i.options.search_type}),r=stackCache.get(o);if(r){t(r)}else{var l=i.options.url.split(".").pop();if(i.options.data!==""){t(i.options.data)}else{if(i.options.jsonp&&l!=="json"){var v=i.options.url;if(v.indexOf("?")!==-1){v+="&callback=?"}else{v+="?callback=?"}f.getJSON(v,o,t)}else{f.getJSON(i.options.url,o,function(y){t(y)})}}}function t(z){var D=parseInt(z.start,10)+parseInt(z.limit,10);var y=z.num_found-z.start-z.limit;if(y<=0){y=-1}if((!z.docs||!z.docs.length)&&z.start!==0){i.$element.find(".scroller-page ul:last").after('<div class="book-end" />');q(false);return}z.start=D;stackCache.set(o,z,60);var C=f.extend([],z.docs);var B=f('<ul class="stack" />');function A(E){if(E>=0&&E<10){return 1}if(E>=10&&E<20){return 2}if(E>=20&&E<30){return 3}if(E>=30&&E<40){return 4}if(E>=40&&E<50){return 5}if(E>=50&&E<60){return 6}if(E>=60&&E<70){return 7}if(E>=70&&E<80){return 8}if(E>=80&&E<90){return 9}if(E>=90&&E<=100){return 10}}if(i.options.search_type!=="loc_sort_order"){i.$wrapper.html(z.num_found+"<br />items").removeClass("empty")}else{i.$wrapper.html("").addClass("empty")}f.each(C,function(H,G){if(!G.title){G.title="NULL"}var F="";if(G.measurement_page_numeric){F=G.measurement_page_numeric}if(F===""||F<200||!F){F=200}if(F>540){F=540}var E="";if(G.measurement_height_numeric){E=G.measurement_height_numeric}if(E===""||E<20||!E){E=20}if(E>39){E=39}var J="";if(G.pub_date){J=G.pub_date}var K="";if(parseInt(G.loc_sort_order,10)===parseInt(i.options.loc_sort_order,10)&&u==="center"){K=" anchorbook"}var I="";if(G.creator&&G.creator.length>0){I=G.creator[0];if(/^([^,]*)/.test(I)){I=I.match(/^[^,]*/)}}if(G.title_link_friendly){G.link="../shelflife/book/"+G.title_link_friendly+"/"+G.id}B.append(f('<div class="itemContainer'+K+'" />').html(f('<span class="cover heat'+A(G.shelfrank)+'" />').css("width",E*i.options.height_multiple+2)).append(f('<span class="pages heat'+A(G.shelfrank)+'" />').css("margin-left",E*i.option.height_multiple+35).css("margin-bottom",-F*i.option.page_multiple-11).css("height",F*i.option.page_multiple+5)).append(f('<li link="'+G.link+'" class="heat'+A(G.shelfrank)+' spine" />').html('<p class="spine-text"><span class="title">'+G.title+'</span><span class="author">'+I+'</span></p><span class="spine-year">'+J+"</span>").css("width",E*i.option.height_multiple).css("height",F*i.option.page_multiple)));B.append(f('<div style="clear:both;" />'))});n.empty().attr("id","stackview"+c++).data("scroller",z).append(B);if(parseInt(z.start,10)<0){i.$element.find(".scroller-page ul:last").after('<div class="book-end" />');i.$element.find(".scroller-loading-next").remove();i.$element.infiniteScroller();return}else{q(n)}}}}});f.fn[d]=function(h){var i;this.each(function(l){var j=f(l),m=f(l).data("stackviewObject");if(!m){j.data("stackviewObject",new b(l,h))}else{if(m[h]){var k=m[h].apply(m,Array.prototype.slice.call(arguments),1);if(i===g&&k!==g){i=k}}}});return i===g?this:i}})(jQuery,window,document);window.stackCache=(function(d,f){var b={},e=d.JSON&&(function(){try{return("localStorage" in d)&&d.localStorage!==null}catch(h){return false}})();return{set:g,get:c,remove:a};function g(j,k,h){var i=h&&new Date(+new Date()+h*1000),m={expires:+i,value:k};if(e){try{localStorage[j]=JSON.stringify(m)}catch(l){return l}}else{b[j]=m}}function c(h){var i,j;if(e){i=localStorage[h];if(i){i=JSON.parse(i)}}else{i=b[h]}if(i){if(i.expires&&i.expires<+new Date()){a(h)}else{j=i.value}}return j}function a(h){if(e){localStorage.removeItem(h)}else{delete b[h]}}})(window);