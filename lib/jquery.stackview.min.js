/*!
 * jQuery infiniteScroller - v0.1pre - 9/24/2010
 * http://benalman.com/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(e){var d="infiniteScroller",c;e.fn[d]=c=function(a){a=e.extend({},c.options,a);var b={Width:"Height",Left:"Top"};e.each(b,function(g,h){if(axis==="x"){b[g]=h=g}b[g.toLowerCase()]=h.toLowerCase()});return this.each(function(){var T=e(this),ar=T[0]===document.body?e(window):T,ag=T.children(".scroller-content"),ae,aq,Y=ag.children(".scroller-loading:first-child"),V=ag.children(".scroller-loading:last-child"),W=ah(Y)||0,Q=ah(V)||0,R=0,M=0,U,aa,S,L;ai(false,true);al(ae.eq(0));function O(){var f=L;L=ap();if(a.pagechange&&f!==L){a.pagechange.call(ae.eq(L),ae.eq(f))}if(a.scroll){a.scroll.call(T,ad(T)-R)}if(a.search_type=="loc_sort_order"){am(-1)}am(1)}O();Z();ao();ar.bind("scroll."+d+" resize."+d,O);T.bind("reflow."+d,Z);T.bind("set-zero."+d,ao);T.bind("move-to."+d,function(g,f){X(f)});T.bind("move-by."+d,function(h,g){var f={dir:1,amount:ab("scroll_by")};g=e.extend(f,typeof g==="number"?{amount:g}:g);if(g.amount==="page"){N(g.dir)}else{an(g.dir*g.amount)}});function Z(){ai(true);ac(L,true)}function ai(f,g){ae=ag.children(".scroller-page");aq=[];U=aa=ad(ae.eq(0));ae.each(function(j){var i=e(this);f&&af(i,aa);aq[j]={start:aa,end:aa+ah(i,true)};aa+=ah(i)});W&&af(Y,U-W);Q&&af(V,aa);var h=P();if(h<0){af(ag,W&&Q?(ah(T)-aa)/2:W?ah(T)-aa:Q?U:-h/2)}else{af(ag,W-U);if(g){}}}function al(f){f.addClass("scroller-page").data(d,{})}function N(g,h){var f=L+g;f=Math.min(Math.max(f,0),ae.length);ac(f,h)}function ac(f,g){X(ae.eq(f),g)}function an(g,f,h){X(g,f,h,true)}function X(i,l,t,h){var o=a.scroll_duration,g=ad(T),q,k,s,p,m,r,n;if(i&&typeof i!=="number"){if((q=e(i)).length){m=W-U-R-ab("offset")[0],r=ak(),n=r.start-r.end;k=aq[ae.index(q)];s=k.start;p=k.end;i=(s-p<n?s:(s+p+n)/2)+m}else{return}}S=f(h?g+i:i+R);if(!t){T.stop(true,false);M=0}if(!o||l){j(S)}else{T.scrollTop(g).animate({scrollTop:S},{step:function(v,u){j(v-M)},duration:o})}function f(u){var v=P();return Math.min(Math.max(u,Math.min(0,v)),Math.max(0,v))}function j(u){ar["scroll"+b.Left](f(u))}}function am(k){var l=k!==1,g=ae.eq(l?0:ae.length-1),j=g.data(d),n=a.fetch,m=l?"prev":"next",h=l?W:Q,f=ad(T),i=(l?f:P()-f)-h;if(h&&!j[m]&&e.isFunction(n)&&i<=ab("threshold")){j[m]=true;setTimeout(function(){n.call(g,k,function(p){if(p===false){if(l){M+=W;ao(R-W);an(-W,true,true);Y.hide();W=0}else{V.hide();Q=0}ai()}else{if(p){var o;p=e(p);al(p);if(l){Y.after(p);o=ah(p);af(p,ad(g)-o);ai();ao(R+o);an(o,true,true);M-=o}else{V.before(p);af(p,ad(g)+ah(g));ai()}am(k)}else{delete j[m]}}})},1)}}function ad(f){return f[0]===T[0]?ar["scroll"+b.Left]():f.position()[b.left]}function af(h,g){var f={};if(g!==ad(h)){f[b.left]=g;h.css(f)}}function ah(f,g){return f[0]===ag[0]?W+Q+aa-U:f[(f[0]===T[0]?"inner":"outer")+b.Width](!g)}function aj(g,f){g[b.width](f)}function ab(g){var f=a[g];return e.isFunction(f)?f.call(T,ah(T)):f}function P(){return ah(ag)-ah(T)}function ao(f){R=typeof f==="number"?f:ad(T)}function ak(){var g=ad(T)+U-W,f=ab("offset");return{start:g+f[0],end:g+ah(T)-f[1]}}function ap(){var h=ak(),i=h.start,m=h.end,g,k=[],l=[],f=[],j;e.each(aq,function(p,o){var n=o.start,q=o.end;if(n>=m){return false}if(n>=i){if(q<=m){g=k.push(p)}else{l.push(p)}}else{if(q>i){l.push(p)}}});f=e.map(g?k:l,function(p){var o=aq[p],n=o.start,q=o.end;return{i:p,d:g?Math.abs((i+m-n-q)/2):n<i?i-q:n-m}}).sort(function(n,o){return n.d-o.d});return f.length?f[0].i:0}})};c.options={axis:"x",threshold:function(a){return a},scroll_by:function(a){return a},position:function(a,b){return(a+b)/2},pagechange:function(a){},scroll:function(a){},scroll_duration:400,offset:[0,0],fetch:null}})(jQuery);
/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 *
 * Requires: 1.2.2+
 */
(function(f){function b(h){var d=h||window.event,l=[].slice.call(arguments,1),j=0,k=0,i=0,h=f.event.fix(d);h.type="mousewheel";d.wheelDelta&&(j=d.wheelDelta/120);d.detail&&(j=-d.detail/3);i=j;d.axis!==void 0&&d.axis===d.HORIZONTAL_AXIS&&(i=0,k=-1*j);d.wheelDeltaY!==void 0&&(i=d.wheelDeltaY/120);d.wheelDeltaX!==void 0&&(k=-1*d.wheelDeltaX/120);l.unshift(h,j,k,i);return(f.event.dispatch||f.event.handle).apply(this,l)}var g=["DOMMouseScroll","mousewheel"];if(f.event.fixHooks){for(var a=g.length;a;){f.event.fixHooks[g[--a]]=f.event.mouseHooks}}f.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var c=g.length;c;){this.addEventListener(g[--c],b,false)}}else{this.onmousewheel=b}},teardown:function(){if(this.removeEventListener){for(var c=g.length;c;){this.removeEventListener(g[--c],b,false)}}else{this.onmousewheel=null}}};f.fn.extend({mousewheel:function(c){return c?this.bind("mousewheel",c):this.trigger("mousewheel")},unmousewheel:function(c){return this.unbind("mousewheel",c)}})})(jQuery);
/*!
 Simple JavaScript Templating originally by John Resig:
 http://ejohn.org/blog/javascript-micro-templating/
 Modified by Rick Strahl:
 http://west-wind.com/weblog/posts/2008/Oct/13/Client-Templating-with-jQuery
 MIT Licensed
*/
(function(){var b={};this.tmpl=function a(e,d){var c=!/\W/.test(e)?b[e]=b[e]||a(document.getElementById(e).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');");return d?c(d):c}})();
/*!
	Stack View - The jQuery virutal stack plugin
	by The Harvard Library Innovation Lab
	
	Dual licensed under MIT and GPL.
*/
(function(g,f,a,h){var d,e="stackview",c,b={};d={init:"stackview.init",page_load:"stackview.pageload"};b.get_heat=function(i){return i===100?10:Math.floor(i/10)+1};b.get_height=function(l,m){var k=parseInt(m.measurement_height_numeric,10),n=l.options.min_book_height,j=l.options.max_book_height,i=l.options.height_multiple;k=Math.min(Math.max(k,n),j)*i;return k+"px"};b.get_thickness=function(k,l){var n=parseInt(l.measurement_page_numeric,10),m=k.options.min_pages,j=k.options.max_pages,i=k.options.pages_multiple;n=Math.min(Math.max(n,m),j)*i;return n+"px"};b.normalize_link=function(i){return i.title_link_friendly?"../shelflife/book/"+i.title_link_friendly+"/"+i.id:i.link};b.get_author=function(j){var i=j.creator&&j.creator.length?j.creator[0]:"";if(/^([^,]*)/.test(i)){i=i.match(/^[^,]*/)}return i};b.render_items=function(i,m,j){var k=j?"after":"append",l=j?j:i.$element.find(i.options.selectors.item_list);g.each(m,function(o,p){var n=g(tmpl(c.templates.book,{heat:b.get_heat(p.shelfrank),book_height:b.get_height(i,p),book_thickness:b.get_thickness(i,p),link:b.normalize_link(p),title:p.title,author:b.get_author(p),year:p.pub_date}));n.data("stackviewItem",p);l[k](n)});if(j){j.remove()}};b.fetch_page=function(j,m){var l,k,i;l={start:j.page*j.options.items_per_page,limit:j.options.items_per_page,search_type:j.options.search_type,query:j.options.query};if(j.options.jsonp){l.callback="?"}i=g.param(l);j.page++;k=f.stackCache.get(j.options.url+l);if(k){m(k)}else{g.getJSON(j.options.url,i,m)}};c=function(j,i){this.element=j;this.$element=g(j);this.options=g.extend({},c.defaults,i);this.page=0;this.finished=false;this.init()};g.extend(c,{defaults:{url:"basic.json",data:"",jsonp:false,items_per_page:10,threshold:1000,page_multiple:0.11,height_multiple:12,search_type:"keyword",query:"",ribbon:"Stack View",min_pages:200,max_pages:540,min_item_height:20,max_item_height:39,cache_ttl:60,selectors:{item:".stack-item",item_list:".stack-items",ribbon:".ribbon-body"}}});g.extend(true,c.prototype,{init:function(){this.$element.html(tmpl(c.templates.scaffold,{ribbon:this.options.ribbon}));this.next_page();this.$element.trigger(d.init)},next_page:function(){var i=g(tmpl(c.templates.placeholder,{})),j=this;if(this.finished){return}if(this.options.data){b.render_items(this,this.options.data.docs);this.finished=true;this.$element.trigger(d.page_load)}else{if(this.options.url){this.$element.find(this.options.selectors.item_list).append(i);b.fetch_page(this,function(k){b.render_items(j,k.docs,i);if(parseInt(k.start,10)===-1){j.finished=true}j.$element.trigger(d.page_load)})}}}});g.fn[e]=function(k){var i,j=Array.prototype.slice.call(arguments,1);this.each(function(m,o){var l=g(o),p=l.data("stackviewObject");if(!p){l.data("stackviewObject",new c(o,k))}else{if(p[k]){var n=p[k](j);if(i===h&&n!==h){i=n}}}});return i===h?this:i};f.StackView=c})(jQuery,window,document);window.stackCache=(function(d,f){var b={},e=d.JSON&&(function(){try{return("localStorage" in d)&&d.localStorage!==null}catch(h){return false}})();return{set:g,get:c,remove:a};function g(j,k,h){var i=h&&new Date(+new Date()+h*1000),m={expires:+i,value:k};if(e){try{localStorage[j]=JSON.stringify(m)}catch(l){return l}}else{b[j]=m}}function c(h){var i,j;if(e){i=localStorage[h];if(i){i=JSON.parse(i)}}else{i=b[h]}if(i){if(i.expires&&i.expires<+new Date()){a(h)}else{j=i.value}}return j}function a(h){if(e){localStorage.removeItem(h)}else{delete b[h]}}})(window);(function(a,b){StackView.templates={scaffold:'			<div class="ribbon">				<div class="ribbon-body"><%= ribbon %></div>				<div class="ribbon-behind" />			</div>			<ul class="stack-items" />',navigation:'			<div class="navigation">				<div class="upstream" />				<div class="num-found" />					<span></span><br />items				</div>				<div class="downstream" />			</div>',book:'			<li class="stack-item stack-book heat<%= heat %>" style="width:<%= book_height %>; height:<%= book_thickness %>;">				<a href="<%= link %>" target="_newtab">					<span class="spine-title"><%= title %></span>					<span class="spine-author"><%= author %></span>					<span class="spine-year"><%= year %></span>				</a>			</li>',placeholder:'<li class="stackview-placeholder"></li>'}})();